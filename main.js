(()=>{"use strict";var e="users/me",t="cards",n="likes",o={Authorization:"cf42a0df-ae43-4b9c-81ff-a75ec02c0ae1","Content-Type":"application/json"},r=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function c(e,t){return fetch("".concat("https://nomoreparties.co/v1/cohort-mag-4","/").concat(e),t).then(r)}var a=(document.forms["edit-profile"],document.forms["new-place"]),u=(document.forms["edit-avatar"],document.querySelector(".popup_type_image"),document.querySelector(".profile__edit-button"),document.querySelector(".profile__add-button"),Array.from(document.querySelectorAll(".popup"))),i=(document.querySelector(".popup_type_edit"),document.querySelector(".popup_type_new-card"),document.querySelector(".popup_type_avatar"),document.querySelector(".popup_type_delete-card")),l=document.forms["delete-card"];function d(e){if("Escape"===e.key){var t=u.find((function(e){return e.classList.contains("popup_is-opened")}));t&&m(t)}}function s(e){e.target===e.currentTarget&&m(e.target)}function p(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",d)}function m(e){e&&(e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",d))}function _(e){m(e.target.closest(".popup"))}document.querySelector(".places__list"),document.querySelector(".profile__image"),document.querySelector(".popup__input_type_name"),document.querySelector(".popup__input_type_description"),document.querySelector(".profile__title"),document.querySelector(".profile__description"),a.elements["place-name"],a.elements.link,document.querySelector(".popup__caption"),document.querySelector(".popup__image");var f=document.querySelector("#card-template").content;function y(e,t,n,o,r){var c=f.querySelector(".card").cloneNode(!0);c.dataset.cardId=e._id;var a=c.querySelector(".card__image"),u=c.querySelector(".card__title"),l=c.querySelector(".card__delete-button"),d=c.querySelector(".card__like-button"),s=c.querySelector(".card__like-count");return a.src=e.link,a.alt=e.name,u.textContent=e.name,e.owner&&e.owner._id!==r&&(l.style.display="none"),e.likes&&e.likes.some((function(e){return e._id===r}))&&d.classList.add("card__like-button_is-active"),s&&(s.textContent=e.likes?e.likes.length:0),l.addEventListener("click",(function(){p(i),i.dataset.cardId=e._id,i.dataset.cardElementId=c.dataset.cardId})),d.addEventListener("click",(function(){return n(e._id,d,s)})),a.addEventListener("click",o),c}function v(e,r,a){var u;(r.classList.contains("card__like-button_is-active")?(u=e,c("".concat(t,"/").concat(u,"/").concat(n),{method:"DELETE",headers:o})):function(e){return c("".concat(t,"/").concat(e,"/").concat(n),{method:"PUT",headers:o})}(e)).then((function(e){r.classList.toggle("card__like-button_is-active"),a&&(a.textContent=e.likes.length)})).catch((function(e){console.error("Ошибка при изменении лайка:",e)}))}var S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"form__input-error_active"},q=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o&&(t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent="")},h=function(e,t,n){var o=n.querySelector(t.submitButtonSelector);o?function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(o.setAttribute("disabled",!0),o.classList.add(t.inactiveButtonClass)):(o.removeAttribute("disabled"),o.classList.remove(t.inactiveButtonClass)):console.error("Submit button not found in form")};const b="6666407ac3aa5af1d5de.jpg";var g=document.querySelector(".places__list"),C=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),k=document.forms["edit-profile"],L=k.elements.name,x=k.elements.description,A=document.forms["new-place"],I=A.elements.link,w=A.elements["place-name"],T=document.querySelector(".popup__image"),B=document.querySelector(".popup__caption"),D=document.querySelector(".popup_type_edit"),P=document.querySelector(".popup_type_new-card"),j=document.querySelector(".popup_type_image"),M=document.querySelector(".profile__edit-button"),N=document.querySelector(".profile__add-button"),O=document.querySelectorAll(".popup__close"),J=document.querySelectorAll(".popup"),G=document.forms["new-avatar"],H=document.querySelector(".popup_type_new-avatar"),z=document.querySelector(".profile__image");z.addEventListener("click",(function(){p(H),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){return q(e,n,t)})),h(n,t,o)}(G,S)}));var U=null;function F(e){p(j);var t=e.target.closest(".card");T.src=t.querySelector(".card__image").src,T.alt=t.querySelector(".card__title").textContent,B.textContent=t.querySelector(".card__title").textContent}c(e,{method:"GET",headers:o}).then((function(e){U=e._id,C.textContent=e.name,E.textContent=e.about,e.avatar&&(document.querySelector(".profile__image").style.backgroundImage="url(".concat(e.avatar,")"))})).catch((function(e){console.error("Ошибка при загрузке данных пользователя:",e)})),c(t,{method:"GET",headers:o}).then((function(e){e.forEach((function(e){var t=y(e,0,v,F,U);g.append(t)}))})).catch((function(e){console.error("Ошибка при загрузке карточек:",e)})),O.forEach((function(e){e.addEventListener("click",_)})),J.forEach((function(e){e.addEventListener("click",s)})),M.addEventListener("click",(function(){L.value=C.textContent,x.value=E.textContent,p(D)})),N.addEventListener("click",(function(){p(P)})),k.addEventListener("submit",(function(t){t.preventDefault();var n,r,a=L.value,u=x.value,i=t.target.querySelector(".popup__button"),l=i.textContent;i.textContent="Сохранение...",i.disabled=!0,(n=a,r=u,c(e,{method:"PATCH",headers:o,body:JSON.stringify({name:n,about:r})})).then((function(e){C.textContent=e.name,E.textContent=e.about,m(D)})).catch((function(e){console.error("Ошибка при обновлении профиля:",e)})).finally((function(){i.textContent=l,i.disabled=!1}))})),A.addEventListener("submit",(function(e){e.preventDefault();var n,r,a={link:I.value,name:w.value},u=e.target.querySelector(".popup__button"),i=u.textContent;u.textContent="Создание...",u.disabled=!0,(n=a.name,r=a.link,c(t,{method:"POST",headers:o,body:JSON.stringify({name:n,link:r})})).then((function(t){var n=y(t,0,v,F,U);g.prepend(n),m(P),e.target.reset()})).catch((function(e){console.error("Ошибка при создании карточки:",e)})).finally((function(){u.textContent=i,u.disabled=!1}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));h(n,t,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?q(e,t,n):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass);var r=t.validationMessage;t.validity.patternMismatch?r=t.dataset.errorMessage:t.validity.tooShort||t.validity.tooLong?r="Текст должен быть от ".concat(t.minLength," до ").concat(t.maxLength," символов"):t.validity.valueMissing&&(r="Это обязательное поле"),o&&(o.textContent=r,o.classList.add(n.errorClass))}(e,t,n)}(e,o,t),h(n,t,e)}))}))}(t,e)}))}(S);var K=document.querySelector(".profile__image");function Q(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение";t.textContent=e?o:n}K&&b&&(K.style.backgroundImage="url(".concat(b,")")),G.addEventListener("submit",(function(t){!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";t.preventDefault();var o=t.submitter,r=o.textContent;Q(!0,o,r,n),e().then((function(){t.target.reset()})).catch((function(e){console.error("Ошибка: ".concat(e))})).finally((function(){Q(!1,o,r,n)}))}((function(){return(t=G.elements["avatar-input"].value,c("".concat(e,"/avatar"),{method:"PATCH",headers:o,body:JSON.stringify({avatar:t})})).then((function(e){z.style.backgroundImage="url('".concat(e.avatar,"')"),m(H)}));var t}),t)})),l.addEventListener("submit",(function(e){e.preventDefault();var n=e.submitter,r=n.textContent;n.textContent="Удаление...";var a,u=i.dataset.cardId,l=i.dataset.cardElementId,d=document.querySelector('.card[data-card-id="'.concat(l,'"]'));d?(a=u,c("".concat(t,"/").concat(a),{method:"DELETE",headers:o})).then((function(){d.remove(),m(i)})).catch((function(e){console.error("Ошибка при удалении карточки:",e)})).finally((function(){n.textContent=r,delete i.dataset.cardId,delete i.dataset.cardElementId})):console.error("Card element not found")}))})();